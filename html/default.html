<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Instagram</title>
</head>
<body>
<script src="bundle.js"></script>

<h1>Welcome to Instagram, <span id="userName"></span></h1>

<div id="main"></div>


<form method='post' action='/upload' enctype='multipart/form-data'>
<br />
<label for="imgName">Image Name</label>
<input type="text" id="imgName" name="ImgName">
<br />
<label for="imgCaption">Image Caption</label>
<input type="text" id="imgCaption" name="ImgCaption">
<br />
  <input type='file' id='image' name='image'/>
  <input type='submit' />
</form>


<div id="feeds"></div>
<form id="loginForm" name="loginForm" action="/logout" method="POST">
  <input type="submit" value="Log Out" name="submit" id="submit" />
</form><br /><br />

</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<script>
  $(function() {
    $.post("/default", null, function(result){
        if (result.error) {
          window.location.replace("/login.html");
        } else {
          $('#userName').html(result.userName);
          getUserFeeds(result.userID);
        }
    }, "json");
  });

  function getUserFeeds(id) {
    var br = document.createElement('br');
    var param = '/getUserFeeds/'+id;
    $.getJSON(param, function(result){
      if (result.error) {
        $('#main').html(result.error);
      } else {
        var feeds = document.getElementById('feeds');
        feeds.innerHTML = '';
        $.each(result, function(i, field) {
          feeds.appendChild(br);
          var img = document.createElement('img');
          img.id = "Img"+ field["ImgID"];
          img.src = 'getImage/' + field["UserID"] + "/" + field["ImgLocation"];
          img.width = '400';
          feeds.appendChild(img);
          var p = document.createElement('p');
          p.innerHTML = field['ImgName'] + ' (' + field['PostDate'] + ')';
          feeds.appendChild(p);
        });
      }      
    }, "json");    
   }
</script>
</html>
